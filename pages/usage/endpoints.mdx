# Creating Endpoints

Creating endpoints with crudsify can be accomplished in three different ways:

* generating endpoints based on model definitions
* defining standalone endpoints
* adding endpoints to a model

## Model endpoints
Restful endpoints are automatically generated based on of any models that you add to your models directory with the file structure of \{model name\}.js. These models must adhere to the following format:

```js
"use strict";
const { Model } = require("sequelize");
module.exports = (sequelize, DataTypes) => {
    class role extends Model {
        static associate(models) {
            // define association here
        }
    }

    role.init({
        /*fill in schema fields*/
    },{
      sequelize,
      modelName: "role",
    });
    return role;
}
```

As a concrete example, here is a user model:
```js filename="models/role.js"
"use strict";
const { Model } = require("sequelize");
const _ = require("lodash");
const {
  getPrimaryKey,
  getTimestamps,
  getMetadata,
  getRecordScopes,
} = require("crudsify/helpers/model");
module.exports = (sequelize, DataTypes) => {
  class role extends Model {
    static associate(models) {
        // association here
        this.hasMany(models.user);
    }
  }
  role.init(
    {
      ..._.cloneDeep(getPrimaryKey(DataTypes)),
      name: {
        type: DataTypes.STRING,
        allowNull: false,
      },
      rank: {
        type: DataTypes.INTEGER,
        allowNull: false,
      },
      description: {
        type: DataTypes.TEXT,
        allowNull: false,
      },
      ..._.cloneDeep(getRecordScopes(DataTypes)),
      ..._.cloneDeep(getTimestamps(DataTypes)),
      ..._.cloneDeep(getMetadata(DataTypes)),
    },
    {
      sequelize,
      modelName: "role",
    }
  );

  return role;
}
```

This will generate the following CRUD endpoints:
```
DELETE /role                            Delete multiple roles
POST /role                              Create one or more new roles
GET /role                               Get a list of roles
DELETE /role/{id}                       Delete a role
GET /role/{id}                          Get a specific role
PUT /role/{id}                          Update a role
```
Association endpoints can also be generated based on model definitions.
```
GET /role/{ownerId}/user                Get all of the users for a role
POST /role/{ownerId}/user               Add multiple users to a role
DELETE /role/{ownerId}/user             Remove multiple users from a role's list of users
PUT /role/{ownerId}/user/{childId}      Add a single user object to a role's list of users
DELETE /role/{ownerId}/user/{childId}   Remove a single user object from a role's list of users
```

> **NOTE**: If your **models** directory is not in your projects root directory, you will need to specify the path (relative to your projects root directory) by assigning the path to the **modelPath** property in configuration and you will need to set the **absoluteModelPath** property to true.

## Standalone endpoints

Standalone endpoints can be generated by adding files to your api directory. The content of these files must adhere to the following format:

```js
"use strict"

const { generateEndpoint } = require("crudsify/endpoints/generate");

generateEndpoint({
  method,
  path,
  auth,
  swaggerPath,
  summary,
  tags,
  validate,
  scope,
  isJsonFields,
  model,
  middlewares,
  handler,
  afterMiddlewares,
  log,
});
```

As a concrete example, here is a hello-world endpoint that will show in the generated swagger docs:

```js filename="apis/hello.js"
"use strict"

const { generateEndpoint } = require("crudsify/endpoints/generate");
const { sendResponse } = require("crudsify/helpers/sendResponse");
generateEndpoint({
    method: "get",
    path: `/hello-world`,
    summary: `Get hello world`,
    tags: ["hello-world"],
    handler: (req, res, next) => {
        sendResponse({
          data: { message: "Hello world." },
          status: 200,
          res,
          next,
        });
    },
    log: "Generating Hello World endpoint.",
  });
```

> NOTE: If your **apis** directory is not in your projects root directory, you will need to specify the path (relative to your projects root directory) by assigning the path to the **apiPath** property in configuration and you will need to set the **absoluteApiPath** property to true.

## Additional endpoints

If endpoints beyond the generated CRUD endpoints are needed for a model, they can easily be added as an item in the **extraEndpoints** array of model. The endpoint logic should be contained within a function using the footprint: (). For example, if we wanted to add a Activatee user endpoint to the user model, it could look like this:

```js filename="models/user.js"
user.extraEndpoints = [
    () => {
        const activateAccountHandler = async function (req, res, next) {
            try {
                await updateHandler(User, {
                params: { id: req.params.id },
                body: { status: true },
                });
                sendResponse({ status: 204, res, next });
            } catch (err) {
                next(err);
            }
        };

        generateEndpoint({
            method: "put",
            path: `/user/:id/activate`,
            summary: "Activate user account.",
            tags: ["user"],
            validate: {
                param,
            },
            scope: ["root", "activateUser", "!-activateUser"],
            auth: authentication,
            middlewares: [rankAuth(sequelize, "id")],
            handler: activateAccountHandler,
            log: `Generating Activate Account endpoint for user.`,
        });
    }
]
```